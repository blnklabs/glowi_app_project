{
  "$schema": "Design System Configuration for F7 + React + Despia Starter",
  "$version": "3.1.0",
  "$description": "Token definitions, component rules, and Despia native patterns for CXD workflow.",

  "colors": {
    "primitive": {
      "black": "#000000",
      "white": "#FFFFFF",
      "gray": {
        "50": "#F9FAFB",
        "100": "#F3F4F6",
        "200": "#E5E7EB",
        "300": "#D1D5DB",
        "400": "#9CA3AF",
        "500": "#6B7280",
        "600": "#4B5563",
        "700": "#374151",
        "800": "#1F2937",
        "900": "#111827"
      },
      "blue": {
        "500": "#007AFF",
        "600": "#0056CC"
      },
      "red": {
        "500": "#FF3B30",
        "600": "#D63029"
      },
      "green": {
        "500": "#34C759",
        "600": "#28A745"
      }
    },
    "ios": {
      "light": {
        "systemBackground": "#F2F2F7",
        "cardBackground": "#FFFFFF",
        "separator": "rgb(231, 231, 232)",
        "label": "#000000",
        "secondaryLabel": "#8E8E93",
        "tertiaryLabel": "#C7C7CC",
        "sectionHeader": "#6D6D72",
        "link": "#007AFF",
        "destructive": "#FF3B30",
        "activeHighlight": "#E5E5EA"
      },
      "dark": {
        "systemBackground": "#000000",
        "cardBackground": "#1C1C1E",
        "separator": "#38383A",
        "label": "#FFFFFF",
        "secondaryLabel": "#8E8E93",
        "tertiaryLabel": "#636366",
        "sectionHeader": "#8E8E93",
        "link": "#007AFF",
        "destructive": "#FF453A",
        "chevron": "#48484A"
      }
    }
  },

  "typography": {
    "fontFamily": {
      "sans": "-apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', Roboto, sans-serif",
      "display": "-apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif"
    },
    "scale": {
      "xs": { "size": "13px", "lineHeight": "18px", "letterSpacing": "-0.08px" },
      "sm": { "size": "14px", "lineHeight": "20px", "letterSpacing": "-0.08px" },
      "base": { "size": "16px", "lineHeight": "22px", "letterSpacing": "-0.41px" },
      "lg": { "size": "17px", "lineHeight": "22px", "letterSpacing": "-0.41px" },
      "xl": { "size": "20px", "lineHeight": "25px", "letterSpacing": "-0.41px" },
      "2xl": { "size": "24px", "lineHeight": "32px", "letterSpacing": "-0.41px" },
      "3xl": { "size": "30px", "lineHeight": "36px", "letterSpacing": "-0.41px" }
    },
    "weight": {
      "normal": "400",
      "medium": "500",
      "semibold": "600",
      "bold": "700"
    }
  },

  "spacing": {
    "ios": {
      "listGroupMargin": "0 16px 20px 16px",
      "listGroupFirstMarginTop": "20px",
      "listItemPadding": "11px 16px",
      "listItemMinHeight": "50px",
      "sectionHeaderMarginBottom": "7px",
      "separatorLeftInset": "16px"
    }
  },

  "borderRadius": {
    "ios": {
      "listCard": "20px",
      "button": "12px",
      "iconBadge": "6px"
    }
  },

  "icons": {
    "library": "framework7-icons",
    "package": "framework7-icons",
    "usage": {
      "navbar": { "size": "24px", "color": "#000000" },
      "backButton": { "icon": "chevron_left", "size": "24px" },
      "tabbar": { "size": "25px", "inactiveIcon": "name", "activeIcon": "name_fill" },
      "listChevron": { "icon": "chevron_right", "size": "18px", "color": "#C7C7CC" }
    },
    "patterns": {
      "f7Icon": "<Icon f7=\"icon_name\" style={{ fontSize: '24px' }} />",
      "f7IconClass": "<i className=\"f7-icons\" style={{ color: '#007AFF' }}>icon_name</i>"
    },
    "rules": [
      "Use Framework7 icons via Icon component or f7-icons class",
      "TabBar icons: use name for inactive, name_fill for active (e.g., house/house_fill)",
      "Back button: use chevron_left icon at 24px",
      "List chevrons: rendered via CSS pseudo-element, not component"
    ]
  },

  "theme": {
    "contextFile": "src/context/ThemeContext.jsx",
    "provider": "ThemeProvider",
    "hook": "useTheme()",
    "api": {
      "isDarkMode": "boolean - current theme state",
      "toggleDarkMode": "function - toggles between light/dark",
      "setIsDarkMode": "function - set specific theme"
    },
    "storage": "localStorage key: 'darkMode'",
    "default": "System preference via prefers-color-scheme",
    "implementation": {
      "cssClass": "html.dark",
      "variables": "F7 CSS variables overridden in index.css"
    }
  },

  "despia": {
    "package": "despia-native",
    "utilityFile": "src/utils/despia.js",
    
    "environmentDetection": {
      "functions": ["isDespia()", "isDespiaIOS()", "isDespiaAndroid()", "getPlatform()"],
      "userAgentCheck": "navigator.userAgent.toLowerCase().includes('despia')",
      "platforms": ["ios", "android", "web"]
    },

    "navigation": {
      "onNativeBackGesture": {
        "function": "onNativeBackGesture(callback)",
        "description": "Register callback for native back navigation events (popstate)",
        "returns": "Cleanup function to remove listeners"
      }
    },
    
    "haptics": {
      "types": {
        "light": {
          "function": "lightHaptic()",
          "protocol": "despia('lighthaptic://')",
          "use": "Most interactions - tab switches, button taps, list items, back navigation"
        },
        "heavy": {
          "function": "heavyHaptic()",
          "protocol": "despia('heavyhaptic://')",
          "use": "Major interactions - drag complete, significant state changes"
        },
        "success": {
          "function": "successHaptic()",
          "protocol": "despia('successhaptic://')",
          "use": "Positive confirmations - form saved, action completed"
        },
        "warning": {
          "function": "warningHaptic()",
          "protocol": "despia('warninghaptic://')",
          "use": "Caution actions - unsaved changes, warnings"
        },
        "error": {
          "function": "errorHaptic()",
          "protocol": "despia('errorhaptic://')",
          "use": "Destructive actions - delete, logout, remove"
        }
      },
      "rules": [
        "All haptic calls are no-ops in web browser",
        "Only execute in Despia native runtime",
        "lightHaptic for most touch interactions",
        "errorHaptic for destructive/dangerous actions",
        "Wrap in isDespia() check (utility functions do this automatically)"
      ]
    },
    
    "safeAreas": {
      "cssVariables": {
        "top": "var(--safe-area-top)",
        "bottom": "var(--safe-area-bottom)"
      },
      "initialization": "initSafeAreas() in main.jsx",
      "usage": [
        "TabBar: height: calc(50px + var(--safe-area-bottom))",
        "TabBar: padding-bottom: var(--safe-area-bottom)",
        "Page content: padding-bottom: 70px"
      ]
    },
    
    "additionalFeatures": {
      "note": "Reference Despia MCP or docs.despia.com for these features",
      "available": [
        "Push notifications",
        "In-app purchases (RevenueCat)",
        "Biometric authentication (Face ID, Touch ID)",
        "iOS Home Widgets",
        "Siri Shortcuts",
        "Background location",
        "Contact access",
        "Native file system",
        "AirPrint"
      ]
    }
  },

  "components": {
    "navbar": {
      "variants": {
        "large": {
          "use": "Main tab views only (Home, Explore in MainView)"
        },
        "standard": {
          "use": "All other pages (Account, sub-pages, modals)"
        }
      },
      "backButton": {
        "pattern": "<Link back><Icon f7=\"chevron_left\" style={{ fontSize: '24px' }} /></Link>",
        "haptic": "lightHaptic() on tap (optional)"
      }
    },
    
    "tabbar": {
      "height": "calc(50px + var(--safe-area-bottom))",
      "paddingBottom": "var(--safe-area-bottom)",
      "iconSize": "25px",
      "labelSize": "10px",
      "haptic": "lightHaptic() on tab change (only when tab actually changes)",
      "iconPattern": {
        "inactive": "f7-icons class with icon name (e.g., house, search)",
        "active": "f7-icons class with _fill variant (e.g., house_fill)"
      }
    },
    
    "iosButton": {
      "className": "ios-button",
      "height": "50px",
      "borderRadius": "12px",
      "haptic": "lightHaptic() on press"
    },
    
    "iosList": {
      "page": {
        "className": "ios-list-page"
      },
      "item": {
        "haptic": "lightHaptic() built-in for link and onClick",
        "destructiveHaptic": "errorHaptic() (must be called explicitly in onClick handler)"
      },
      "footerLink": {
        "haptic": "lightHaptic() built-in"
      }
    }
  },

  "hapticMapping": {
    "interactions": {
      "tabSwitch": "lightHaptic",
      "buttonPress": "lightHaptic",
      "listItemTap": "lightHaptic",
      "backNavigation": "lightHaptic",
      "accountIconTap": "lightHaptic",
      "footerLinkTap": "lightHaptic",
      "formSubmitSuccess": "successHaptic",
      "unsavedChangesWarning": "warningHaptic",
      "logout": "errorHaptic",
      "deleteAccount": "errorHaptic",
      "deleteData": "errorHaptic",
      "destructiveAction": "errorHaptic"
    }
  },

  "rules": {
    "critical": [
      "NO React.StrictMode - causes F7 components to double-initialize",
      "Navbar: use NavLeft + NavTitle children, NOT title/left props",
      "Icons: Use Framework7 icons via Icon f7=\"name\" or f7-icons class",
      "Range: ALWAYS in Block with styling, NEVER in ListItem",
      "CSS import order: F7 bundle BEFORE Tailwind",
      "Lists: Use IosList components, NOT F7 List/ListItem",
      "Safe areas: Initialize in main.jsx with initSafeAreas()",
      "Haptics: Always wrapped in isDespia() check (utility does this)",
      "Destructive actions: Use errorHaptic(), not lightHaptic()",
      "Dark mode: Wrap app in ThemeProvider from ThemeContext"
    ],
    "despia": [
      "All despia() calls must be wrapped in isDespia() check",
      "Use utility functions from src/utils/despia.js",
      "Test in browser (haptics are no-ops) AND in Despia app",
      "Safe area CSS variables have fallbacks for web preview"
    ]
  },

  "fileStructure": {
    "src": {
      "components": ["IosList.jsx", "TabBar.jsx", "DebugOverlay.jsx"],
      "context": ["ThemeContext.jsx"],
      "pages": ["MainView.jsx", "HomePage.jsx", "AccountPage.jsx", "AccountSecurityPage.jsx", "AccountPreferencesPage.jsx", "AccountNotificationsPage.jsx", "AccountAboutPage.jsx"],
      "styles": ["index.css"],
      "utils": ["despia.js"],
      "root": ["App.jsx", "main.jsx", "routes.js"]
    },
    "notes": {
      "HomePage": "Standalone page component, not used in current routes (MainView handles Home tab)",
      "DebugOverlay": "Development tool for debugging navigation - disabled by default in App.jsx"
    }
  }
}
